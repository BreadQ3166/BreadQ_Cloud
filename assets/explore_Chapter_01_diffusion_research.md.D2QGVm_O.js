import{_ as c,c as r,G as i,j as a,a as u,a4 as d,B as o,o as h}from"./chunks/framework.c_DFoYEo.js";const g=JSON.parse('{"title":"前言","description":"","frontmatter":{},"headers":[],"relativePath":"explore/Chapter_01/diffusion/research.md","filePath":"explore/Chapter_01/diffusion/research.md"}'),n={name:"explore/Chapter_01/diffusion/research.md"};function p(m,l,b,k,f,q){const t=o("confetti"),e=o("Linkcard"),s=o("ArticleMetadata");return h(),r("div",null,[i(t),i(e,{url:"/explore/Chapter_01/diffusion/research",title:"🍰标志物生成的小组汇报",description:"阶段性的AI绘画学习总结",logo:"https://gitee.com/the-origin-of-bread/images_-pic-go/raw/master/images/logo_4.jpg"}),l[0]||(l[0]=a("hr",null,null,-1)),l[1]||(l[1]=a("h1",{id:"前言",tabindex:"-1"},[u("前言 "),a("a",{class:"header-anchor",href:"#前言","aria-label":'Permalink to "前言"'},"​")],-1)),i(s),l[2]||(l[2]=d('<blockquote><p>🍊Hello，各位好，我是面包！</p><p>这篇文档集合了面包的科研实训的经历。</p></blockquote><h2 id="🥕进度汇报" tabindex="-1">🥕进度汇报 <a class="header-anchor" href="#🥕进度汇报" aria-label="Permalink to &quot;🥕进度汇报&quot;">​</a></h2><hr><h3 id="_2024年9月25日" tabindex="-1">2024年9月25日 <a class="header-anchor" href="#_2024年9月25日" aria-label="Permalink to &quot;2024年9月25日&quot;">​</a></h3><ul><li>初步确定科研实训课题--基本标志物识别</li><li>了解通过Stable Diffusion的lora训练AI绘画的基本流程</li></ul><hr><h3 id="_2024年9月29日" tabindex="-1">2024年9月29日 <a class="header-anchor" href="#_2024年9月29日" aria-label="Permalink to &quot;2024年9月29日&quot;">​</a></h3><ul><li>安装B站秋叶的WebUI整合包</li><li>上手了AI绘画的文生图的基本流程</li><li>根据Up主nely同学的lora教程训练了一个原神角色凝光的人物lora，打通了lora训练的基本流程</li><li>进行lora训练，学会打标签</li></ul><hr><h3 id="_2024年10月15日" tabindex="-1">2024年10月15日 <a class="header-anchor" href="#_2024年10月15日" aria-label="Permalink to &quot;2024年10月15日&quot;">​</a></h3><ul><li>拍摄处于干净背景中以黑白圆盘标志物为中心的各种视角的图片</li><li>进行生图流程，实现了图片的生成</li></ul><div class="danger custom-block"><p class="custom-block-title">DANGER</p><p>加入了lora训练的生图工作流的成片结果基本过拟合，无法生成背景，缺乏泛化性</p></div><hr><h3 id="_2024年11月13日" tabindex="-1">2024年11月13日 <a class="header-anchor" href="#_2024年11月13日" aria-label="Permalink to &quot;2024年11月13日&quot;">​</a></h3><ul><li>学习基于Stable Diffusion的图形操作界面comfyui</li></ul><div class="tip custom-block"><p class="custom-block-title">小纸条</p><p>通过节点搭建AI绘画工作流的工具</p></div><ul><li>实现生成不同大小，不同清晰度，不同背景的图片</li></ul><div class="warning custom-block"><p class="custom-block-title">灵光点</p><ol><li>不同光效-&gt;iclight模型</li><li>不同数量-&gt;图片融合再调整尺寸</li><li>不同视角-&gt;手动拍摄50到100张统一大小且不同视角的图片，再调整成纯色背景</li><li>批量生成-&gt;api调用</li></ol></div><div class="danger custom-block"><p class="custom-block-title">问题</p><ol><li>lora无法训练不同模糊度，不同数量，不同大小的图片，训练出的图片大多是固定大小，固定模糊度，不同视角的图片，</li><li>对于训练不同视角的图片，由于基本标志物的细节要严格与实物一致，所以训练的lora基本上都要过拟合，这样又缺乏泛化性，上次会议说过泛化性，但后面我在训练时发现，过拟合也基本只能生成与图片数据集出现过的视角的图片，不会有新的视角，</li></ol></div><hr><h3 id="_2024年11月20日" tabindex="-1">2024年11月20日 <a class="header-anchor" href="#_2024年11月20日" aria-label="Permalink to &quot;2024年11月20日&quot;">​</a></h3><ul><li>通过comfyui搭建了一个工作流</li><li>实现批量并随机生成不同大小、不同数量、不同模糊度、不同背景、不同视角的灰度图像</li><li>24张不同视角的标志物图片作为工作流基础数据</li><li>生成随机的图片集</li></ul><div class="warning custom-block"><p class="custom-block-title">下一步</p><ol><li>微调或优化</li><li>了解模型量化与知识蒸馏</li></ol></div><hr><h3 id="_2024年11月29日" tabindex="-1">2024年11月29日 <a class="header-anchor" href="#_2024年11月29日" aria-label="Permalink to &quot;2024年11月29日&quot;">​</a></h3><ul><li>尝试了动态提示词与图片反推提示词的节点流效果</li><li>使用工业相机拍摄了基本标志物在实际场景下的样例照片</li></ul><hr><h3 id="_2024年12月4日" tabindex="-1">2024年12月4日 <a class="header-anchor" href="#_2024年12月4日" aria-label="Permalink to &quot;2024年12月4日&quot;">​</a></h3><ul><li>添加了雨幕附加和高清放大的节点流程</li><li>重新回顾了comfyui的部署流程，在win10服务器上部署了comfyui</li><li>进行预计1.5w~2w的图片生成任务</li></ul><hr><h3 id="_2024年12月4日-1" tabindex="-1">2024年12月4日 <a class="header-anchor" href="#_2024年12月4日-1" aria-label="Permalink to &quot;2024年12月4日&quot;">​</a></h3><ul><li>完成生成1.5w~2w张图片的任务</li></ul><div class="danger custom-block"><p class="custom-block-title">图片要求</p><ol><li>数量：15000张（包含）</li><li>分辨率：1440*1080</li><li>标志物出现数量：1，2-5，5-10，10以上</li></ol></div><div class="tip custom-block"><p class="custom-block-title">图片分类</p><ol><li>室内设计</li><li>学习环境</li><li>桥梁设计</li></ol></div><div class="warning custom-block"><p class="custom-block-title">图片格式</p><ol><li>线性</li><li>线性+模糊</li><li>线性+雨幕</li><li>线性+模糊+雨幕</li></ol></div><hr><h3 id="_2025年1月14日" tabindex="-1">2025年1月14日 <a class="header-anchor" href="#_2025年1月14日" aria-label="Permalink to &quot;2025年1月14日&quot;">​</a></h3><ul><li><p>基于sd1.5大模型生成2w张图片数据，实际上只生成了5k张，然后对这些图片进行后期处理，大概可以分成清晰的，模糊的，清晰并附加噪点的，模糊附加噪点的。</p></li><li><p>发现comfyui可以实现对图片进行简单的标注，但如果一张图片中出现多张或多种标志物久不能准确识别了，有一定概率会识别不到</p></li><li><p>熟悉了一下yolo模型的训练过程，大概就是对收集的图片数据进行标注，然后将标注后的数据进行模型训练</p></li><li><p>尝试优化comfyui的工作流，调用其他大模型比如sdxl、flux,但目前的实际效果感觉不如sd1.5.</p></li><li><p>使用Florence进行图像分割，生成BBOX标注数据</p></li></ul><div class="danger custom-block"><p class="custom-block-title">问题</p><p>标注成功概率并非100%</p></div><ul><li>尝试flux的canny,depth重绘模型</li></ul><div class="danger custom-block"><p class="custom-block-title">问题</p><p>与周围环境融为一体，无法生成物品的明显边界感</p></div><ul><li>尝试sdxl的controlnet++模型</li></ul><div class="danger custom-block"><p class="custom-block-title">问题</p><p>生成图片背景不过真实</p></div><ul><li></li></ul><hr><h2 id="🥥可行性记录" tabindex="-1">🥥可行性记录 <a class="header-anchor" href="#🥥可行性记录" aria-label="Permalink to &quot;🥥可行性记录&quot;">​</a></h2><h3 id="🍎批量生成图片" tabindex="-1">🍎批量生成图片 <a class="header-anchor" href="#🍎批量生成图片" aria-label="Permalink to &quot;🍎批量生成图片&quot;">​</a></h3><ul><li>comfyui界面左上角下三角选项中设置批次数量【失败】</li></ul><div class="danger custom-block"><p class="custom-block-title">问题</p><p>初次加载太慢</p></div><ul><li>comfyui界面左上角下三角选项中设置不断生成，按照时间设定【成功】</li></ul><h3 id="🥞生成多视角图片" tabindex="-1">🥞生成多视角图片 <a class="header-anchor" href="#🥞生成多视角图片" aria-label="Permalink to &quot;🥞生成多视角图片&quot;">​</a></h3><ul><li>通过lora训练生成新的视角【失败】</li></ul><div class="tip custom-block"><p class="custom-block-title">🥬数据集的尝试-解决生成图像不同视角【失败】</p><ol><li>第一次尝试</li></ol><p>​ 收集了14张以白色桌子为背景的纯标志物图片，以45度为差值和俯视和正视两视图为控制变量</p><p>​ 结果：过拟合，基本只能生成以 白色为背景的图片</p><ol start="2"><li>第二次尝试</li></ol><p>​ 收集了16张通过ps抠图的图片，其余操作同上</p><p>​ 结果：可以实现背景的简单替换，但生成稳定标志物的稳定性较差，也不能很好地实现视角的提示词</p><p>变换</p><ol start="3"><li>第三次尝试</li></ol><p>​ 在前面数据集的基础上再添加了8张平视视角的纯白背景标志物图片，同时将所有数据集进行模糊化处理再次生成了24张模糊的数据集，最后再添加4张具有现实场景的图片</p><p>​ 结果：SD对模糊度的提示词控制力不够，导致产生的图片基本都有些模糊，无法经过提示词很好地控制，</p><p>​ 反思：通过数据集来进行提示词的模糊处理不靠谱。lora只用来训练固定大小，但不同数量，不同视角的图片，而模糊处理、缩放、场景替换则通过comfyui搭建节点工作流来实现。</p></div><div class="danger custom-block"><p class="custom-block-title">问题</p><p>生成的图片过拟合</p></div><ul><li>通过Stable zero123节点【未进行】</li></ul><div class="danger custom-block"><p class="custom-block-title">问题</p><ol><li>显存不够</li><li>网络不稳定</li></ol></div><ul><li>图片随机抽取【已成功】</li></ul><div class="tip custom-block"><p class="custom-block-title">小纸条</p><ol><li>拍摄50张左右干净背景、同等大小的标志物图片</li><li>通过语义分割生成等分辨率、纯色背景的图片</li><li>通过随机读取节点进行工作流的基础图片输入</li></ol></div><h3 id="🌭ai扩图-解决生成物品随机位置与大小" tabindex="-1">🌭AI扩图-解决生成物品随机位置与大小 <a class="header-anchor" href="#🌭ai扩图-解决生成物品随机位置与大小" aria-label="Permalink to &quot;🌭AI扩图-解决生成物品随机位置与大小&quot;">​</a></h3><ul><li>使用inpainting大模型【未进行】</li><li>编写自动化脚本进行大规模随机生成【未进行】</li><li>利用扩展画布【已成功】</li></ul><div class="tip custom-block"><p class="custom-block-title">小纸条</p><ol><li>生成与标志物有明显色差的纯色背景，比如（0,255,0）</li><li>通过扩展画布进行随机扩展</li><li>将图片缩放成最符合大模型训练集的尺寸接入工作流</li></ol></div><h3 id="🥕图像模糊-解决生成图像模糊度" tabindex="-1">🥕图像模糊-解决生成图像模糊度 <a class="header-anchor" href="#🥕图像模糊-解决生成图像模糊度" aria-label="Permalink to &quot;🥕图像模糊-解决生成图像模糊度&quot;">​</a></h3><ol><li>附加节点进行模糊处理【成功】</li></ol><div class="tip custom-block"><p class="custom-block-title">小纸条</p><p>利用高斯模糊直接进行模糊处理</p></div><h3 id="🥪不同光效" tabindex="-1">🥪不同光效 <a class="header-anchor" href="#🥪不同光效" aria-label="Permalink to &quot;🥪不同光效&quot;">​</a></h3><ul><li>在comfyui里使用ic-light节点【成功】</li></ul><div class="tip custom-block"><p class="custom-block-title">小纸条</p><ol><li>通过数学表达式节点随机生成圆形的遮罩，同时羽化边缘</li><li>调节应用ICLight节点连接的K采样器节点的降噪系数，系数越低，光照越接近光影遮罩</li></ol></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><ul><li>插件：【IC-Light】</li><li>节点工具：【加载ICLight模型】、【应用ICLight条件】</li><li>实现流程：通过模型与遮罩实现光影替换，并可以进一步添加图像细节</li></ul></div><h3 id="🍒随机数量" tabindex="-1">🍒随机数量 <a class="header-anchor" href="#🍒随机数量" aria-label="Permalink to &quot;🍒随机数量&quot;">​</a></h3><ul><li>通过遮罩复合节点生成生成【失败】</li><li>通过将正交(1<em>1，2</em>2，3<em>3,4</em>4)的图片组合，从有标志物与无标志物的图片中选取【成功】</li></ul><h3 id="🧀导出多个图像坐标" tabindex="-1">🧀导出多个图像坐标 <a class="header-anchor" href="#🧀导出多个图像坐标" aria-label="Permalink to &quot;🧀导出多个图像坐标&quot;">​</a></h3><ul><li>调用A=1的次数-&gt;图片中标志物的个数</li><li>将向左拓展作为x坐标，向上拓展作为y坐标，尺度缩放</li><li>将缩放后尺寸与缩放前尺寸作为缩放比例因子，进行比例降化</li></ul><div class="tip custom-block"><p class="custom-block-title">小纸条</p><ol><li>原缩放坐标/sqrt(输入照片数)</li><li>原缩放坐标/sqrt(输入照片数)，x轴+256</li><li>原缩放坐标/sqrt(输入照片数)，y轴+256</li><li>原缩放坐标/sqrt(输入照片数)，x轴+256，y轴+256</li></ol></div><h3 id="🥑雨幕添加" tabindex="-1">🥑雨幕添加 <a class="header-anchor" href="#🥑雨幕添加" aria-label="Permalink to &quot;🥑雨幕添加&quot;">​</a></h3><p>通过基础文生图工作流生成透明背景的雨幕图片，然后通过【图像混合模式】节点与高清放大后的图片通过【hard light模式】融合。</p><h3 id="🥘高清放大" tabindex="-1">🥘高清放大 <a class="header-anchor" href="#🥘高清放大" aria-label="Permalink to &quot;🥘高清放大&quot;">​</a></h3><p>通过分块采样与潜空间缩放生成与工业相机拍摄图片尺寸相符的图片</p><h3 id="🥮图片随机或有序读取" tabindex="-1">🥮图片随机或有序读取 <a class="header-anchor" href="#🥮图片随机或有序读取" aria-label="Permalink to &quot;🥮图片随机或有序读取&quot;">​</a></h3><ol><li>通过【图像批量处理】节点实现随机读取，可以实现单个标志物的图像生成</li><li>添加for循环实现随机选取并正交拼接，实现图片的单个或多个标志物随机选取，，但有可能只选到背景，没有标志物，特别是在一个标志物选择范围内，有二分之一的几率无标志物生成，浪费算力资源</li><li>添加switch节点，无法解决问题，switch与for循环节点之间 可能有调用冲突</li><li>将switch节点换成if节点，解决了生成一个标志物范围时大概率无标志物生成的问题，但生成多个标志物范围时还有小概率生成无标志物图片</li><li>利用for循环索引进行if判断，从而保证至少有一个标志物生成</li></ol><div class="warning custom-block"><p class="custom-block-title">前提</p><ul><li>插件：【was-node-suite-comfyui】</li><li>节点工具：【加载批次图像】</li><li>实现流程：设置模式为【single_image、incremental_image、random】-&gt; 设置绝对路径</li></ul></div><h3 id="🍝提示词随机生成" tabindex="-1">🍝提示词随机生成 <a class="header-anchor" href="#🍝提示词随机生成" aria-label="Permalink to &quot;🍝提示词随机生成&quot;">​</a></h3><div class="warning custom-block"><p class="custom-block-title">前提</p><ul><li>插件：【comfyui-dynamicprompts】</li><li>节点工具：【动态提示词】、【BrushNet加载器】</li><li>实现流程：通过模型处理可实现背景替换</li></ul></div><h3 id="🍛数据集的挑选" tabindex="-1">🍛数据集的挑选 <a class="header-anchor" href="#🍛数据集的挑选" aria-label="Permalink to &quot;🍛数据集的挑选&quot;">​</a></h3><p>1.将黑白圆盘放在桌子上，围绕标志物以45度和视角为变量拍摄 16张图片作为训练集</p><p>2.ps抠图制作 纯白背景</p><p>3.将sd1.5大模型修改成其他真实场景的大模型</p><h3 id="🍿背景" tabindex="-1">🍿背景 <a class="header-anchor" href="#🍿背景" aria-label="Permalink to &quot;🍿背景&quot;">​</a></h3><ol><li>通过扩图实现</li></ol><p>1.数据集收集，纯白背景，斜上方-8，正上方-8，</p><p>触发词，背景光影，视角</p><h3 id="🍺拍摄图片预处理" tabindex="-1">🍺拍摄图片预处理 <a class="header-anchor" href="#🍺拍摄图片预处理" aria-label="Permalink to &quot;🍺拍摄图片预处理&quot;">​</a></h3><div class="warning custom-block"><p class="custom-block-title">前提</p><ul><li>插件：【】</li><li>节点工具：【SAM模型加载器】、【G-Dino模型加载器】、【G-DinoSAM语义分割】</li><li>实现流程：通过模型处理后可得到去除背景的遮罩与图片，把拍摄图片添加绿幕（0,255,0）</li></ul></div><h3 id="🍦图片不同大小" tabindex="-1">🍦图片不同大小 <a class="header-anchor" href="#🍦图片不同大小" aria-label="Permalink to &quot;🍦图片不同大小&quot;">​</a></h3><div class="warning custom-block"><p class="custom-block-title">前提</p><ul><li>插件：【essentials】、【Custom-Scripts】、【LayerStyle】</li><li>节点工具：【数学表达式】、【拓展画布】</li><li>实现流程：通过随机函数并通过数学关系输入有限制的随机数将图像替换成等比例不同大小的图片</li></ul></div><h3 id="🥪图片背景" tabindex="-1">🥪图片背景 <a class="header-anchor" href="#🥪图片背景" aria-label="Permalink to &quot;🥪图片背景&quot;">​</a></h3><div class="warning custom-block"><p class="custom-block-title">前提</p><ul><li>插件：【BrushNet】、【LayerStyle】</li><li>节点工具：【BrushNet】、【BrushNet加载器】、【LaMa】</li><li>实现流程：通过模型处理可实现符合语义的背景替换</li></ul></div><h2 id="🍩弯路" tabindex="-1">🍩弯路 <a class="header-anchor" href="#🍩弯路" aria-label="Permalink to &quot;🍩弯路&quot;">​</a></h2><ul><li>任何路径都不要有中文路径和空格，否则会生成一些紊乱的图片效果</li><li>简单图片容易过拟合，不要老觉得是训练不够，图片混乱十有八九是过拟合了</li><li>报错有可能是模型不匹配</li></ul><div class="warning custom-block"><p class="custom-block-title">问题</p><ol><li>生成图片经过K采样器降噪后基本标志物不能很好地保留原始的圆或对角特征</li></ol><p>对经过BrushNet扩图流程的图像与原始绿幕图片经过一定系数的遮罩叠加后再输入后续生图流程</p><ol start="2"><li>直接进行sd1.5的1440*1080尺寸图片生成效果不好</li></ol><p>先通过sd1.5生成与训练图片集（512×512）相似的尺寸（720×544），然后通过高清放大进行图片扩大</p></div>',99))])}const x=c(n,[["render",p]]);export{g as __pageData,x as default};
